<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Strategy Matrix</title>
    <style>
      body { font-family: Inter, Arial, sans-serif; margin: 0; background: linear-gradient(180deg, #f8fafc 0%, #eef4ff 100%); color: #0b1220; }
      main { max-width: 1020px; margin: 32px auto; padding: 0 16px; }
      .card { background: #fff; border: 1px solid #dbe3ef; border-radius: 14px; padding: 16px; box-shadow: 0 8px 22px rgba(11, 18, 32, 0.06); }
      .row { display: flex; justify-content: space-between; align-items: baseline; gap: 12px; flex-wrap: wrap; margin-bottom: 8px; }
      .hint { color: #4b5563; font-size: 14px; margin: 0; }
      .toolbar { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 16px; }
      .chip { border: 1px solid #cbd5e1; border-radius: 999px; background: #fff; color: #334155; padding: 6px 12px; font-size: 13px; cursor: pointer; transition: .15s ease; }
      .chip:hover { border-color: #2563eb; color: #1d4ed8; }
      .chip.active { background: #2563eb; border-color: #1d4ed8; color: #fff; }
      svg { width: 100%; height: auto; background: #fff; }
      .tooltip { position: fixed; pointer-events: none; background: #0b1220; color: #fff; padding: 10px 12px; border-radius: 8px; font-size: 12px; line-height: 1.4; display: none; max-width: 280px; box-shadow: 0 10px 25px rgba(15, 23, 42, 0.35); }
      .legend { font-size: 12px; fill: #334155; }
      .summary { margin-top: 14px; display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 8px; }
      .summary-item { border: 1px solid #dbe3ef; border-radius: 10px; padding: 10px 12px; background: #f8fafc; }
      .summary-item strong { display: block; font-size: 18px; color: #0f172a; }
    </style>
  </head>
  <body>
    <main>
      <div class="card">
        <div class="row">
          <h1>Strategy Matrix</h1>
          <span class="hint" id="count"></span>
        </div>
        <p class="hint">X-Axis: Effort / Y-Axis: Impact</p>
        <div class="toolbar" id="filters" role="toolbar" aria-label="Quadrant filter controls"></div>
        <svg id="matrix" viewBox="0 0 860 520" aria-label="Strategy matrix scatter plot"></svg>
        <div class="summary" id="summary"></div>
      </div>
    </main>
    <div id="tooltip" class="tooltip"></div>
    <script>
      const svg = document.getElementById('matrix');
      const tooltip = document.getElementById('tooltip');
      const count = document.getElementById('count');
      const filters = document.getElementById('filters');
      const summary = document.getElementById('summary');
      const margin = { top: 20, right: 20, bottom: 40, left: 50 };
      const width = 860 - margin.left - margin.right;
      const height = 520 - margin.top - margin.bottom;
      let allProjects = [];
      let activeFilter = 'All';

      const x = (v) => margin.left + (v / 100) * width;
      const y = (v) => margin.top + height - (v / 100) * height;

      function add(el) { svg.appendChild(el); return el; }
      function rect(xVal, yVal, w, h, fill, opacity) {
        const el = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        el.setAttribute('x', xVal); el.setAttribute('y', yVal);
        el.setAttribute('width', w); el.setAttribute('height', h);
        el.setAttribute('fill', fill); el.setAttribute('opacity', opacity);
        return el;
      }
      function line(x1, y1, x2, y2, stroke) {
        const el = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        el.setAttribute('x1', x1); el.setAttribute('y1', y1);
        el.setAttribute('x2', x2); el.setAttribute('y2', y2);
        el.setAttribute('stroke', stroke);
        return el;
      }
      function text(content, xVal, yVal, css='legend') {
        const el = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        el.textContent = content; el.setAttribute('x', xVal); el.setAttribute('y', yVal);
        el.setAttribute('class', css);
        return el;
      }
      function escapeHtml(value) {
        return String(value).replace(/[&<>"']/g, (char) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[char]));
      }
      function getVisibleProjects() {
        return activeFilter === 'All'
          ? allProjects
          : allProjects.filter((project) => project.quadrantLabel === activeFilter);
      }
      function showTooltip(project, left, top) {
        tooltip.style.display = 'block';
        tooltip.style.left = `${left}px`;
        tooltip.style.top = `${top}px`;
        tooltip.innerHTML = `<strong>${escapeHtml(project.title)}</strong><br>${escapeHtml(project.quadrantLabel)}<br>Impact ${project.impact} / Effort ${project.effort}`;
      }
      function drawDots(projects) {
        svg.querySelectorAll('circle').forEach((circle) => circle.remove());
        projects.forEach((project) => {
          const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          dot.setAttribute('cx', x(project.effort));
          dot.setAttribute('cy', y(project.impact));
          dot.setAttribute('r', 7);
          dot.setAttribute('fill', '#2563eb');
          dot.setAttribute('stroke', '#1e3a8a');
          dot.setAttribute('stroke-width', '1');
          dot.setAttribute('tabindex', '0');
          dot.setAttribute('aria-label', `${project.title}. ${project.quadrantLabel}. Impact ${project.impact}. Effort ${project.effort}`);
          dot.style.cursor = 'pointer';
          dot.addEventListener('mousemove', (event) => {
            showTooltip(project, event.clientX + 12, event.clientY + 12);
          });
          dot.addEventListener('focus', () => {
            const box = dot.getBoundingClientRect();
            showTooltip(project, box.left + 12, box.top - 54);
          });
          dot.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
              event.preventDefault();
              const box = dot.getBoundingClientRect();
              showTooltip(project, box.left + 12, box.top - 54);
            }
            if (event.key === 'Escape') tooltip.style.display = 'none';
          });
          dot.addEventListener('blur', () => { tooltip.style.display = 'none'; });
          dot.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });
          add(dot);
        });
      }
      function renderSummary(projects) {
        const labels = ['Quick Wins', 'Big Bets', 'Fillers', 'Time Sinks'];
        summary.replaceChildren();
        labels.forEach((label) => {
          const countByLabel = projects.filter((project) => project.quadrantLabel === label).length;
          const item = document.createElement('div');
          item.className = 'summary-item';
          const labelEl = document.createElement('span');
          labelEl.className = 'hint';
          labelEl.textContent = label;
          const countEl = document.createElement('strong');
          countEl.textContent = String(countByLabel);
          item.appendChild(labelEl);
          item.appendChild(countEl);
          summary.appendChild(item);
        });
      }
      function renderFilters() {
        const labels = ['All', 'Quick Wins', 'Big Bets', 'Fillers', 'Time Sinks'];
        filters.replaceChildren();
        labels.forEach((label) => {
          const button = document.createElement('button');
          button.className = `chip${activeFilter === label ? ' active' : ''}`;
          button.setAttribute('aria-pressed', activeFilter === label ? 'true' : 'false');
          button.setAttribute('data-label', label);
          button.textContent = label;
          filters.appendChild(button);
        });
      }
      filters.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-label]');
        if (!button) return;
        activeFilter = button.getAttribute('data-label');
        renderFilters();
        const visibleProjects = getVisibleProjects();
        count.textContent = `${visibleProjects.length} / ${allProjects.length} projects`;
        drawDots(visibleProjects);
      });

      async function render() {
        const response = await fetch('./data.json');
        const data = await response.json();
        allProjects = data.projects;
        count.textContent = `${allProjects.length} / ${allProjects.length} projects`;

        add(rect(margin.left, margin.top, width / 2, height / 2, '#d1fae5', '0.35'));
        add(rect(margin.left + width / 2, margin.top, width / 2, height / 2, '#dbeafe', '0.35'));
        add(rect(margin.left, margin.top + height / 2, width / 2, height / 2, '#fef3c7', '0.35'));
        add(rect(margin.left + width / 2, margin.top + height / 2, width / 2, height / 2, '#fee2e2', '0.35'));

        add(line(margin.left, margin.top + height / 2, margin.left + width, margin.top + height / 2, '#64748b'));
        add(line(margin.left + width / 2, margin.top, margin.left + width / 2, margin.top + height, '#64748b'));

        add(text('Quick Wins', margin.left + 8, margin.top + 16));
        add(text('Big Bets', margin.left + width / 2 + 8, margin.top + 16));
        add(text('Fillers', margin.left + 8, margin.top + height / 2 + 16));
        add(text('Time Sinks', margin.left + width / 2 + 8, margin.top + height / 2 + 16));

        add(text('Effort', margin.left + width / 2 - 14, margin.top + height + 32));
        add(text('Impact', 10, margin.top + height / 2));

        drawDots(allProjects);
        renderFilters();
        renderSummary(allProjects);
      }

      render().catch((error) => {
        count.textContent = 'Failed to load matrix data';
        console.error(error);
      });
    </script>
  </body>
</html>
